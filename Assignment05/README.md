# Customer and Order Management API

This simple Node.js application assginment provides a RESTful API for managing customers, orders, and products. It is built using Express and MySQL, and it does not use any ORM. All database operations are performed using raw SQL queries.

## Features

- Customer Management
  - Sign up
  - Login [no auth - dummy]
- Product Management
  - Add product
  - Find total revenue generated by each category of products
  - Find total number of items sold for each product
- Order Management
  - Create order
  - Calculate average order value
  - List all customers who have not made any orders
  - Find the customer who has purchased the most items in total
  - List the top 10 customers who have spent the most money
  - List all customers who have made at least 5 orders
  - Find the percentage of customers who have made more than one order
  - Find the customer who has made the earliest order

## Table of Contents

- [Installation](#installation)
- [Usage](#usage)
- [API Endpoints](#api-endpoints)
  - [Customer APIs](#customer-apis)
  - [Product APIs](#product-apis)
  - [Order APIs](#order-apis)
- [Database Schema](#database-schema)
- [Contributing](#contributing)

## Installation

1. Clone the repository:

   ```sh
   git clone https://github.com/Farahat612/Route-NodeJS-Assignments/tree/master/Assignment05
   cd customer-order-management
   ```

2. Install the dependencies:

   ```sh
   npm install
   ```

3. Set up your `MySQL` database and update the connection details in `utils/db.js`.

4. Use `sql` code provided in `utils/SQL-DDL.sql` to create your database schema.

## Usage

1. Start the server:

   ```sh
   npm start
   ```

2. The API will be available at `http://localhost:5000`.

## API Endpoints

### Customer APIs

- **Sign Up**

  - **URL:** `/customers/signup`
  - **Method:** `POST`
  - **Request Body:**

    ```json
    {
      "first_name": "John",
      "last_name": "Doe",
      "email": "john.doe@example.com",
      "phone": "1234567890"
    }
    ```

  - **Response:** `201 Created`

- **Login**

  - **URL:** `/customers/login`
  - **Method:** `POST`
  - **Request Body:**

    ```json
    {
      "email": "john.doe@example.com",
      "phone": "1234567890"
    }
    ```

  - **Response:** `200 OK`

### Product APIs

- **Add Product**

  - **URL:** `/products/add`
  - **Method:** `POST`
  - **Request Body:**

    ```json
    {
      "product_name": "Laptop",
      "category": "Electronics",
      "unit_price": 1200
    }
    ```

  - **Response:** `201 Created`

- **Find Total Revenue by Category**

  - **URL:** `/products/revenue`
  - **Method:** `GET`
  - **Response:** `200 OK`

- **Find Total Number of Items Sold per Product**
  - **URL:** `/products/items-sold`
  - **Method:** `GET`
  - **Response:** `200 OK`

### Order APIs

- **Create Order**

  - **URL:** `/orders/create`
  - **Method:** `POST`
  - **Request Body:**

    ```json
    {
      "customer_id": 1,
      "order_date": "2024-06-06",
      "order_items": [
        {
          "productid": 1,
          "quantity": 2
        },
        {
          "productid": 2,
          "quantity": 1
        }
      ]
    }
    ```

  - **Response:** `201 Created`

- **Calculate Average Order Value**

  - **URL:** `/orders/average-value`
  - **Method:** `GET`
  - **Response:** `200 OK`

- **List Customers with No Orders**

  - **URL:** `/orders/no-orders`
  - **Method:** `GET`
  - **Response:** `200 OK`

- **Find Customer with Most Items Purchased**

  - **URL:** `/orders/most-items`
  - **Method:** `GET`
  - **Response:** `200 OK`

- **List Top 10 Customers by Spending**

  - **URL:** `/orders/top-spending`
  - **Method:** `GET`
  - **Response:** `200 OK`

- **List Customers with at Least 5 Orders**

  - **URL:** `/orders/at-least-five-orders`
  - **Method:** `GET`
  - **Response:** `200 OK`

- **Find Percentage of Repeat Customers**

  - **URL:** `/orders/repeat-customers-percentage`
  - **Method:** `GET`
  - **Response:** `200 OK`

- **Find Customer with Earliest Order**
  - **URL:** `/orders/earliest-order`
  - **Method:** `GET`
  - **Response:** `200 OK`

## Database Schema

### Customers Table

```sql
CREATE TABLE Customers (
    id INT AUTO_INCREMENT PRIMARY KEY,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    phone VARCHAR(20)
);
```

### Products Table

```sql
CREATE TABLE Products (
    id INT AUTO_INCREMENT PRIMARY KEY,
    product_name VARCHAR(100) NOT NULL,
    category VARCHAR(100),
    unit_price DECIMAL(10, 2) NOT NULL
);
```

### Orders Table

```sql
CREATE TABLE Orders (
    id INT AUTO_INCREMENT PRIMARY KEY,
    customer_id INT,
    order_date DATE,
    total_amount DECIMAL(10, 2) NOT NULL,
    FOREIGN KEY (customer_id) REFERENCES Customers(id)
);
```

### OrderItems Table

```sql
CCREATE TABLE OrderItems (
    id INT AUTO_INCREMENT PRIMARY KEY,
    order_id INT,
    product_id INT,
    quantity INT NOT NULL,
    unit_price DECIMAL(10, 2) NOT NULL,
    FOREIGN KEY (order_id) REFERENCES Orders(id),
    FOREIGN KEY (product_id) REFERENCES Products(id)
);
```

## Contributing

1. Fork the repository.
2. Create your feature branch (git checkout -b feature/fooBar).
3. Commit your changes (git commit -am 'Add some fooBar').
4. Push to the branch (git push origin feature/fooBar).
5. Create a new Pull Request.
